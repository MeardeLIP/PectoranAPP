name: Build iOS App (Simple)

# ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ ÑÐ±Ð¾Ñ€ÐºÐ¸ iOS Ð±ÐµÐ· Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸
# Ð”Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

on:
  workflow_dispatch:  # Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ñ€ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº
  push:
    branches:
      - main
      - master

jobs:
  build:
    name: Build iOS App
    runs-on: macos-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: PectoranMobile/package-lock.json
      
      - name: Install dependencies
        working-directory: ./PectoranMobile
        run: npm ci
      
      - name: Install CocoaPods
        run: |
          sudo gem install cocoapods
          pod --version
      
      - name: Install CocoaPods dependencies
        working-directory: ./PectoranMobile/ios
        run: pod install
      
      - name: Build for Simulator
        working-directory: ./PectoranMobile/ios
        run: |
          xcodebuild build \
            -workspace PectoranMobile.xcworkspace \
            -scheme PectoranMobile \
            -configuration Release \
            -sdk iphonesimulator \
            -destination 'platform=iOS Simulator,name=iPhone 15' \
            -derivedDataPath build
      
      - name: Archive (Ð±ÐµÐ· Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ - Ð´Ð»Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸)
        working-directory: ./PectoranMobile/ios
        continue-on-error: true
        run: |
          echo "âš ï¸ Ð”Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ IPA Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒÑŽ Ð½ÑƒÐ¶Ð½Ñ‹:"
          echo "  1. Apple Developer Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚"
          echo "  2. ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð¸"
          echo "  3. Ð¡ÐµÐºÑ€ÐµÑ‚Ñ‹ Ð² GitHub: TEAM_ID, APPLE_ID Ð¸ Ñ‚.Ð´."
          echo ""
          echo "ðŸ“± Ð”Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ IPA Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ:"
          echo "  - Xcode Ð½Ð° Mac (Product â†’ Archive)"
          echo "  - Ð˜Ð»Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ workflow Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒÑŽ"
      
      - name: Summary
        run: |
          echo "## âœ… Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ“± ÐŸÑ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ ÑÐ¾Ð±Ñ€Ð°Ð½Ð¾ Ð´Ð»Ñ iOS ÑÐ¸Ð¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð°" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âš ï¸ Ð”Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ IPA Ñ„Ð°Ð¹Ð»Ð° Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¾Ð¹ Ð½Ð° Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°:" >> $GITHUB_STEP_SUMMARY
          echo "1. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Xcode Ð½Ð° Mac" >> $GITHUB_STEP_SUMMARY
          echo "2. Ð˜Ð»Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ GitHub Actions Ñ Apple Developer Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð¾Ð¼" >> $GITHUB_STEP_SUMMARY
          echo "3. Ð˜Ð»Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ñ‚Ð¸Ð¿Ð° Codemagic, AppCircle" >> $GITHUB_STEP_SUMMARY

