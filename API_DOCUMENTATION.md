# PectoranAPP - API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üîó –ë–∞–∑–æ–≤—ã–π URL

```
Development: http://localhost:3000/api
Production: https://your-domain.com/api
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã (–∫—Ä–æ–º–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏) —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:

```
Authorization: Bearer <your-jwt-token>
```

## üìã API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### POST /auth/login
–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞/–¥–∏—Ä–µ–∫—Ç–æ—Ä–∞

**Request:**
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**Response:**
```json
{
  "success": true,
  "message": "–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ",
  "data": {
    "user": {
      "id": 1,
      "username": "admin",
      "role": "admin",
      "full_name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã"
    },
    "accessToken": "jwt-token",
    "refreshToken": "refresh-token",
    "expiresIn": "24h"
  }
}
```

#### POST /auth/waiter-login
–ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞

**Request:**
```json
{
  "waiter_number": 1,
  "role": "waiter"
}
```

#### POST /auth/cook-login
–ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –ø–æ–≤–∞—Ä–∞

**Request:**
```json
{
  "waiter_number": 101,
  "role": "cook"
}
```

#### POST /auth/logout
–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

#### GET /auth/me
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

### –ú–µ–Ω—é

#### GET /menu
–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –º–µ–Ω—é

**Response:**
```json
{
  "success": true,
  "data": {
    "menu": [
      {
        "id": 1,
        "name": "–ù–∞–ø–∏—Ç–∫–∏",
        "items": [
          {
            "id": 1,
            "name": "–ö–æ—Ñ–µ –∞–º–µ—Ä–∏–∫–∞–Ω–æ",
            "price": 150.00,
            "description": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —á–µ—Ä–Ω—ã–π –∫–æ—Ñ–µ",
            "preparation_time": 3
          }
        ]
      }
    ]
  }
}
```

#### GET /menu/categories
–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### POST /menu/categories
–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### PUT /menu/categories/:id
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### DELETE /menu/categories/:id
–£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### GET /menu/items
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –º–µ–Ω—é (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### POST /menu/items
–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### PUT /menu/items/:id
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### DELETE /menu/items/:id
–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –º–µ–Ω—é (—Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä)

### –ó–∞–∫–∞–∑—ã

#### POST /orders
–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (—Ç–æ–ª—å–∫–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç)

**Request:**
```json
{
  "table_number": 5,
  "items": [
    {
      "menu_item_id": 1,
      "quantity": 2,
      "notes": "–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞"
    }
  ],
  "notes": "–°—Ç–æ–ª–∏–∫ —É –æ–∫–Ω–∞",
  "customer_name": "–ò–≤–∞–Ω",
  "customer_phone": "+7900123456"
}
```

**Response:**
```json
{
  "success": true,
  "message": "–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ",
  "data": {
    "order": {
      "id": 1,
      "table_number": 5,
      "status": "new",
      "total_amount": 300.00,
      "orderItems": [
        {
          "id": 1,
          "menu_item_id": 1,
          "quantity": 2,
          "price_at_order": 150.00,
          "total_price": 300.00
        }
      ]
    }
  }
}
```

#### GET /orders
–ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤

**Query Parameters:**
- `status` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `table_number` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–æ–ª–∏–∫—É
- `waiter_id` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—É
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)

#### GET /orders/active
–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

#### GET /orders/:id
–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞

#### PUT /orders/:id/status
–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

**Request:**
```json
{
  "status": "preparing",
  "notes": "–ù–∞—á–∞–ª –≥–æ—Ç–æ–≤–∏—Ç—å"
}
```

#### GET /orders/:id/history
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–∞

#### DELETE /orders/:id
–û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### GET /stats/daily
–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∞–¥–º–∏–Ω/–¥–∏—Ä–µ–∫—Ç–æ—Ä)

**Query Parameters:**
- `start_date` - –¥–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ (ISO 8601)
- `end_date` - –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (ISO 8601)
- `waiter_id` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç—É

**Response:**
```json
{
  "success": true,
  "data": {
    "stats": {
      "period": {
        "start": "2024-01-01T00:00:00Z",
        "end": "2024-01-01T23:59:59Z"
      },
      "orders": {
        "total": 25,
        "completed": 23,
        "total_revenue": 15000.00,
        "average_order_value": 600.00
      },
      "status_breakdown": [
        {
          "status": "new",
          "count": 5,
          "avg_duration": 2.5
        }
      ],
      "popular_items": [
        {
          "menu_item_id": 1,
          "total_quantity": 50,
          "order_count": 25,
          "total_revenue": 7500.00
        }
      ],
      "waiters": [
        {
          "waiter": {
            "id": 1,
            "username": "waiter1",
            "full_name": "–û—Ñ–∏—Ü–∏–∞–Ω—Ç 1"
          },
          "orders_count": 10,
          "total_revenue": 6000.00,
          "avg_order_value": 600.00
        }
      ]
    }
  }
}
```

#### GET /stats/waiter/:id
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞

#### GET /stats/popular-items
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

#### GET /stats/revenue
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤—ã—Ä—É—á–∫–∏

#### GET /stats/performance
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

#### GET /users
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∞–¥–º–∏–Ω/–¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### GET /users/roles
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∏ –∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π

#### POST /users
–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω/–¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### GET /users/:id
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### PUT /users/:id
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω/–¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### DELETE /users/:id
–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω/–¥–∏—Ä–µ–∫—Ç–æ—Ä)

#### PUT /users/:id/activate
–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### PUT /users/:id/deactivate
–î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### GET /users/role/:role
–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–æ–ª–∏

## üîå WebSocket Events

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```javascript
const socket = io('ws://localhost:3000');

// –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
socket.emit('authenticate', {
  userId: 1,
  role: 'waiter'
});
```

### –°–æ–±—ã—Ç–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

#### order:create
–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```javascript
socket.emit('order:create', {
  orderId: 1,
  tableNumber: 5,
  items: [...]
});
```

#### order:status_change
–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

```javascript
socket.emit('order:status_change', {
  orderId: 1,
  newStatus: 'preparing',
  previousStatus: 'accepted'
});
```

### –°–æ–±—ã—Ç–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

#### order:new
–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ (–¥–ª—è –ø–æ–≤–∞—Ä–æ–≤)

```javascript
socket.on('order:new', (data) => {
  console.log('–ù–æ–≤—ã–π –∑–∞–∫–∞–∑:', data);
});
```

#### order:updated
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞

```javascript
socket.on('order:updated', (data) => {
  console.log('–ó–∞–∫–∞–∑ –æ–±–Ω–æ–≤–ª–µ–Ω:', data);
});
```

#### order:ready
–ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤ (–¥–ª—è –æ—Ñ–∏—Ü–∏–∞–Ω—Ç–∞)

```javascript
socket.on('order:ready', (data) => {
  console.log('–ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤:', data);
});
```

## üìä –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–æ–≤

- `200` - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `201` - –†–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞–Ω
- `400` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `401` - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- `403` - –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
- `404` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `409` - –ö–æ–Ω—Ñ–ª–∏–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

## üîí –†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –û—Ñ–∏—Ü–∏–∞–Ω—Ç (waiter)
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ (ready, delivered)

### –ü–æ–≤–∞—Ä (cook)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ (accepted, preparing, ready)

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (admin)
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –ù–ï –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –º–µ–Ω—é

### –î–∏—Ä–µ–∫—Ç–æ—Ä (director)
- –í—Å–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é
- –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (JavaScript)

```javascript
const createOrder = async (orderData) => {
  const response = await fetch('/api/orders', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(orderData)
  });
  
  return await response.json();
};
```

### WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (JavaScript)

```javascript
import io from 'socket.io-client';

const socket = io('ws://localhost:3000');

socket.on('connect', () => {
  socket.emit('authenticate', {
    userId: 1,
    role: 'waiter'
  });
});

socket.on('order:new', (order) => {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞
  console.log('–ù–æ–≤—ã–π –∑–∞–∫–∞–∑:', order);
});
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "success": false,
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
  "errors": [
    {
      "field": "username",
      "message": "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ"
    }
  ]
}
```
